
<div class="w-full bg-white shadow-md rounded-xl duration-500 hover:scale-105 hover:shadow-xl overflow-hidden flex flex-col md:flex-row relative">

    {% if contenido.categoria.tipo_categoria in categorias_restringidas and not user.is_authenticated %}
    <a href="#" onClick="mostrarModalLogin(event)">
    {% elif contenido.categoria.tipo_categoria == 'PA' and contenido.categoria.id not in categorias_suscritas_ids %}
    <a href="#" onClick="mostrarModal(event, '{{ contenido.categoria.id }}')">
    {% else %}
    <a href="{% url 'detalle_contenido' contenido.slug %}">
    {% endif %}    

        <!-- Imagen -->
        <div class="h-48 md:h-48 lg:h-48 xl:h-36 lg:w-36 flex-none bg-gray-200 overflow-hidden">
            <img src="{{ contenido.imagen.url }}" alt="{{ contenido.titulo }}" class="object-cover w-full h-full rounded-t-lg md:rounded-l-lg md:rounded-t-none">
        </div>
        <!-- Categoría -->
        <div class="absolute top-2 right-2 bg-gray-100 text-gray-600 text-xs px-3 py-1 rounded-full" >
            <button id="CategoryButton" onClick="CategoryHandler(event, '{{ contenido.categoria.id }}')"  class="hover:underline hover:text-pink-700">
                {{ contenido.categoria.nombre_categoria }}
            </button>
        </div>
        <!-- Información -->
        <div class="px-4 py-3 w-full flex flex-col justify-between leading-normal overflow-hidden">
            <!-- Autor y Fecha -->
            <div class="flex items-center justify-between mb-2">
                <div class="flex items-center">
                    <img class="w-8 h-8 rounded-full mr-4" src="{% if contenido.autor.profile.image %}{{ contenido.autor.profile.image.url }}{% else %}/static/default.png{% endif %}" alt="Foto del autor">
                    <div class="text-sm">
                        {% if contenido.autor is null %}
                        <p class="text-gray-900 leading-none">[eliminado]</p>
                        {% else %}
                        <p class="text-gray-900 leading-none">{{ contenido.autor.username }}</p>
                        {% endif %}
                        <p class="text-gray-600 text-xs">{{ contenido.fecha_creacion|date:"d M Y" }}</p>
                    </div>
                </div>
            </div>
            <!-- Título -->
            <div class="mb-4">
                <div class="text-gray-900 font-bold text-lg mb-1 truncate" >{{ contenido.titulo }}</div>
            <!-- Descripción -->
                <p class="text-gray-700 text-xs overflow-hidden" 
                    style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; font-size: 0.85rem;">
                    {{ contenido.resumen|truncatewords:30 }}
                </p>
            </div>
            <!-- Botón de Opciones  -->
            <div class="absolute bottom-2 right-2">
                <div class="relative">
                    <button onClick="toggleMenu(event, '{{ contenido.id }}')" class="text-gray-500 hover:text-pink-700 focus:outline-none">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                            <circle cx="12" cy="5" r="1.5"/>
                            <circle cx="12" cy="12" r="1.5"/>
                            <circle cx="12" cy="19" r="1.5"/>
                        </svg>
                    </button>
                    <!-- Menú desplegable -->
                    <div id="menu-{{ contenido.id }}" class="hidden absolute right-0 bottom-8 w-40 bg-white rounded-md shadow-lg z-50">
                        <div class="py-2">
                            {% if perms.permissions.inactivar_contenido %}
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-pink-700">Inactivar</a>
                            {% endif %}
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-pink-700">Compartir</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </a>
</div>

<script>
    function toggleMenu(event, contenidoId) {
        event.preventDefault();  // Evitar que el clic propague al enlace padre
        event.stopPropagation();  
        const menu = document.getElementById('menu-' + contenidoId);
        menu.classList.toggle('hidden');
    }
    function CategoryHandler(event, categoriaId) {
        event.preventDefault();  // Evitar que el clic propague al enlace padre
        event.stopPropagation();  
        window.location.href = `/categorias/${categoriaId}/`;
    }
    function mostrarModal(event, categoriaId) {
        event.preventDefault();  
        event.stopPropagation();  
        const modal = document.getElementById('modal');
        modal.classList.remove('hidden');
    }
    function mostrarModalLogin(event) {
        event.preventDefault();  
        event.stopPropagation();  
        const modal = document.getElementById('modalLogin');
        modal.classList.remove('hidden');
    }
</script>

{% include 'includes/pago_categoria.html' with categoria=contenido.categoria %}
{% include 'includes/iniciar_sesion.html' %}