{% extends "base.html" %}

{% load static %}

{% block title %}
{{ contenido.titulo }} | Stark Blog
{% endblock %}

{% block content %}
<!-- Mensajes de avisos/exitos -->
<div class="mx-1 mb-4">
    {% if messages %}
    <div class="space-y-3">
        {% for message in messages %}
        <div
            class="p-4 rounded-md {% if message.tags == 'error' %}bg-red-100 text-red-800{% else %}bg-green-100 text-green-800{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>

<!-- Imagen con categoría -->
<section id="summary" class="bg-white rounded-xl overflow-hidden mb-4 mx-auto" style="max-width: 90%; height: auto;">

    <div class="p-6 ">
        <!-- Información de la categoría -->
        <a href="{% url 'categories:detalle' contenido.categoria.id %}"
            class="leading-none font-semibold mb-2 text-pink-700 hover:underline hover:text-pink-700">
            {{ contenido.categoria.nombre_categoria }}
        </a>

        <!-- Título del contenido -->
        <h1 class="text-3xl font-bold text-gray-900 mb-4 text-left break-words">{{ contenido.titulo }}</h1>

        <!-- Resumen -->
        {% if contenido.resumen %}
        <div class="text-gray-700 mb-4 text-left">
            <p>{{ contenido.resumen }}</p>
        </div>
        {% endif %}
    </div>

    <!-- Autor y Fecha -->
    <div class="ml-6 mt-4 mr-6 mb-6 flex items-center justify-between text-sm text-gray-500">
        <div class="flex items-center">
            <img class="w-10 h-10 rounded-full mr-4"
                src="{% if contenido.autor.profile.image %}{{ contenido.autor.profile.image.url }}{% else %}{% static 'default.png' %}{% endif %}"
                alt="{{ contenido.autor.username }}">
            <div>
                <p class="leading-none font-semibold">{{ contenido.autor.username }}</p>
                <p>Publicado el <time datetime="{{ contenido.fecha_modificacion }}">{{contenido.fecha_modificacion|date:"d M Y"}}</time></p>
            </div>
        </div>
        <div class="flex space-x-4 items-center">
            <!-- Estrellas y puntuación -->
            <div class="flex items-center space-x-1 text-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="#ec4899" class="w-6 h-6">
                    <path fill-rule="evenodd"
                        d="M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401Z"
                        clip-rule="evenodd" />
                </svg>
                <span class="text-pink-700 font-bold">0/5</span>
            </div>

            <!-- Botón de Reportar -->
            <button onclick="openModal('{{ contenido.slug }}')" class="bg-red-500 text-white py-2 px-4 rounded-lg">
                Reportar
            </button>

            {% if is_admin %}
            <form method="post" action="{% url 'contenido_seleccionado' contenido.slug %}">
                {% csrf_token %}
                {% if not seleccionado %}
                <button type="submit" name="select_content">Seleccionar Contenido</button>
                {% else %}
                <p>Este contenido ya ha sido seleccionado.</p>
                {% endif %}
            </form>
            {% endif %}
        </div>
    </div>

    <div class="relative aspect-[4/3]">
        <img src="{{ contenido.imagen.url }}" alt="{{ contenido.titulo }}" class="w-full h-full object-cover">
    </div>
    
    <!-- Botones de inactivar y estadísticas alineados a la derecha -->
    <div class="flex justify-end space-x-4 p-6">
        {% if perms.permissions.inactivar_contenido %}
        <form id="inactivateForm-{{ contenido.id }}" action="{% url 'inactivar_contenido' contenido.id %}" method="POST">
            {% csrf_token %}
            {% if contenido.activo %}
            <button type="button" onclick="openInactivateModal('inactivateForm-{{ contenido.id }}')"
                class="bg-gray-400 hover:bg-gray-500 text-white text-xs py-2 px-4 rounded-md">
                Inactivar Contenido
            </button>
            {% else %}
            <button type="button" onclick="openInactivateModal('inactivateForm-{{ contenido.id }}')"
                class="bg-gray-400 hover:bg-gray-500 text-white text-xs py-2 px-4 rounded-md">
                Activar Contenido
            </button>
            {% endif %}
        </form>
        {% endif %}
    </div>
</section>

<!-- Modal para el reporte -->
<div id="reportModal" class="hs-overlay hidden fixed top-0 start-0 z-50 w-full h-full bg-gray-500 bg-opacity-75">
    <div class="flex justify-center items-center h-full">
        <div class="bg-white rounded-lg shadow-md w-full max-w-md p-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Reportar Contenido</h3>
            <form id="reportForm" method="post" action="">
                {% csrf_token %}
                {{ form.as_p }}
                <div class="flex justify-end mt-4 space-x-2">
                    <button type="button" onclick="closeModal()"
                        class="bg-gray-400 text-white hover:bg-gray-500 py-2 px-4 rounded-lg">Cancelar</button>
                    <button type="submit" class="bg-red-500 text-white py-2 px-4 rounded-lg">Reportar</button>
                </div>
            </form>
        </div>
    </div>
</div>


<div id="confirmInactivateModal"
    class="hs-overlay hidden fixed top-0 start-0 z-50 w-full h-full bg-gray-500 bg-opacity-75">
    <div class="flex justify-center items-center h-full">
        <div class="bg-white rounded-lg shadow-md w-full max-w-md p-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Confirmación</h3>
            <p class="text-gray-600">¿Estás seguro de que deseas inactivar este contenido?</p>
            <div class="flex justify-end mt-4 space-x-2">
                <button type="button" onclick="closeInactivateModal()"
                    class="bg-gray-400 text-white hover:bg-gray-500 py-2 px-4 rounded-lg">Cancelar</button>
                <button id="confirmInactivateButton" type="button"
                    class="bg-pink-800 text-white hover:bg-pink-700 py-2 px-4 rounded-lg">Confirmar</button>
            </div>
        </div>
    </div>
</div>

<script>

    function openModal(slug) {
        document.getElementById('reportModal').classList.remove('hidden');
        document.getElementById('reportForm').action = "{% url 'detalle_contenido' slug='slug_placeholder' %}".replace('slug_placeholder', slug);
    }

    
    function closeModal() {
        document.getElementById('reportModal').classList.add('hidden');
    }

  
    function openInactivateModal(formId) {
        document.getElementById('confirmInactivateModal').classList.remove('hidden');
        const confirmInactivateButton = document.getElementById('confirmInactivateButton');

        confirmInactivateButton.onclick = function () {
            document.getElementById(formId).submit();
        };
    }


    function closeInactivateModal() {
        document.getElementById('confirmInactivateModal').classList.add('hidden');
    }
</script>
{% endblock %}
